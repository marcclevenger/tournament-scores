<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Quick Score Update</title>
  <style>
    body { font-family: -apple-system, sans-serif; padding:20px; max-width:600px; margin:auto; background:#f9f9f9; }
    textarea { width:100%; height:60vh; font-size:18px; padding:12px; border:2px solid #333; border-radius:8px; font-family:monospace; }
    button { font-size:20px; padding:15px; margin-top:15px; width:100%; background:#000; color:white; border:none; border-radius:8px; cursor:pointer; }
    button:hover { background:#333; }
    .ok { color:green; font-weight:bold; font-size:18px; }
    .error { color:red; }
    #current { margin-top:10px; padding:10px; background:white; border-radius:5px; }
  </style>
</head>
<body>

<h1>Quick Score Update</h1>
<p>Enter scores as simple numbers (e.g., 28 for Score A, 21 for Score B). They'll fill your table rows automatically.</p>
<div id="current"></div>
<textarea id="newcontent" placeholder="Example for two games:
28 21
35 14
(One line per game: Score A, space, Score B)"></textarea>

<button onclick="save()">Save & Update Website →</button>
<p id="msg"></p>

<script>
// Load current scores on page load
fetch('https://raw.githubusercontent.com/marcclevenger/tournament-scores/main/scores.html')
  .then(r => r.text())
  .then(text => {
    const scores = text.match(/<td>(\d+)<\/td><td>(\d+)<\/td>/g) || []; // Extract existing scores if any
    document.getElementById('current').innerHTML = scores.length ? `<strong>Current scores:</strong> ${scores.join(', ')}` : '<strong>No scores yet—add some!</strong>';
  });

async function save() {
  let input = document.getElementById('newcontent').value.trim();
  if (!input) return document.getElementById('msg').innerHTML = '<span class="error">Enter scores first!</span>';

  // Format input to table rows (assumes your scores.html has structure like <tr><td>Date</td><td>Team A</td><td></td><td></td><td>Team B</td></tr>)
  const lines = input.split('\n').filter(l => l.trim());
  let scoreRows = '';
  lines.forEach(line => {
    const [a, b] = line.trim().split(/\s+/);
    if (a && b) scoreRows += `<td>${a}</td><td>${b}</td>`;
  });
  if (!scoreRows) return document.getElementById('msg').innerHTML = '<span class="error">Invalid format—use "28 21"</span>';

  let token = localStorage.getItem('token');
  if (!token) {
    token = prompt("GitHub token (one-time):");
    if (!token) return;
    localStorage.setItem('token', token);
  }

  document.getElementById('msg').textContent = "Saving…";

  try {
    const info = await fetch('https://api.github.com/repos/marcclevenger/tournament-scores/contents/scores.html').then(r=>r.json());
    const fullContent = `<!-- Your existing scores.html header/structure here --><table><!-- Insert scores -->${scoreRows}</table><!-- End -->`; // Customize if needed
    
    const res = await fetch('https://api.github.com/repos/marcclevenger/tournament-scores/contents/scores.html', {
      method: 'PUT',
      headers: { Authorization: 'token '+token, 'Content-Type': 'application/json' },
      body: JSON.stringify({
        message: 'Updated scores – ' + new Date().toLocaleString(),
        content: btoa(unescape(encodeURIComponent(fullContent))),
        sha: info.sha
      })
    });

    if (res.ok) {
      document.getElementById('msg').innerHTML = "✓ Saved!<br>Refresh main site in 30–60s";
      document.getElementById('msg').className = "ok";
    } else {
      document.getElementById('msg').innerHTML = '<span class="error">Save failed—check token or format</span>';
    }
  } catch(e) {
    document.getElementById('msg').innerHTML = '<span class="error">Network error: ' + e.message + '</span>';
  }
}
</script>

</body>
</html>
